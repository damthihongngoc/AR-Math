<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AR Calculator</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <link rel="stylesheet" href="../css/practice.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
  </head>
  <body>
    <audio
      id="sound-bg"
      src="../../public/audios/home-soundtrack.mp3"
      preload="auto"
      loop
    ></audio>

    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
      <div class="loader"></div>
      <div class="loading-text">Đang tải, xin chờ...</div>
    </div>
    <!-- Overlay Buttons -->
    <div class="overlay-buttons">
      <button onclick="window.location.href='../index.html'">
        <i class="fa fa-times-circle" aria-hidden="true"></i>
      </button>
      <button id="btnGuide">
        <i class="fa fa-info-circle" aria-hidden="true"></i>
      </button>
    </div>

    <div id="modalGuide" class="modal">
      <div class="modal-content">
        <button class="close-btn" data-close="modalGuide">
          <i class="fa fa-times" aria-hidden="true"></i>
        </button>

        <!-- Slide wrapper -->
        <div class="slides">
          <!-- Slide 1 -->
          <div class="slide active">
            <h2>CHUẨN BỊ THẺ</h2>
            <ul>
              <li>
                In các thẻ số từ 0-9 và các phép toán (+, -, ×, ÷) lên giấy
                trắng.
              </li>
              <li>
                Hãy cắt chúng một cách gọn gàng và giữ cho các thẻ luôn sạch sẽ!
              </li>
            </ul>
          </div>

          <!-- Slide 2 -->
          <div class="slide">
            <h2>CHO PHÉP TRUY CẬP</h2>
            <ul>
              <li>
                Khi vào ứng dụng, máy tính của bạn sẽ yêu cầu quyền truy cập
                camera.
              </li>
              <li>
                Nhấn "Cho phép" để bắt đầu cuộc phiêu lưu toán học của bạn!
              </li>
            </ul>
          </div>

          <!-- Slide 3 -->
          <div class="slide">
            <h2>SẮP XẾP CÁC THẺ</h2>
            <ul>
              <li>Đặt các thẻ theo thứ tự: SỐ - PHÉP TOÁN - SỐ</li>
              <li>Ví dụ: 2 + 3 hoặc 5 × 4</li>
            </ul>
          </div>

          <!-- Slide 4 -->
          <div class="slide">
            <h2>XEM KẾT QUẢ</h2>
            <ul>
              <li>
                Kết quả sẽ xuất hiện dưới dạng 3D ngay trên màn hình của bạn!
              </li>
              <li>Di chuyển các thẻ để thử các phép tính khác nhau!</li>
            </ul>
          </div>

          <!-- Slide 5 -->
          <div class="slide">
            <h2>MỘT SỐ LƯU Ý</h2>
            <ul>
              <li>Đảm bảo có đủ ánh sáng để camera nhận diện các thẻ tốt.</li>
              <li>
                Giữ các thẻ ổn định và cách đều nhau để có kết quả ổn định hơn.
              </li>
              <li>Không để các thẻ bị mờ hoặc bị che khuất.</li>
              <li>Thử nghiệm với các phép tính khác nhau để khám phá thêm!</li>
            </ul>
          </div>
        </div>

        <!-- Điều khiển -->
        <div class="slide-controls">
          <button class="slide-button prevSlide">
            <i class="fa fa-chevron-left" aria-hidden="true"></i>
          </button>
          <button class="slide-button nextSlide">
            <i class="fa fa-chevron-right" aria-hidden="true"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- AR Scene -->
    <a-scene
      mindar-image="imageTargetSrc: ../targets.mind; maxTrack: 3; uiLoading:no; uiScanning:no; filterMinCF:0.0005; filterBeta:0.01"
      renderer="antialias: false"
      xr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
      disable-ar
    >
      <a-assets>
        <a-asset-item id="zeroModel" src="../3d-models/zero.glb"></a-asset-item>
        <a-asset-item id="oneModel" src="../3d-models/one.glb"></a-asset-item>
        <a-asset-item id="twoModel" src="../3d-models/two.glb"></a-asset-item>
        <a-asset-item
          id="threeModel"
          src="../3d-models/three.glb"
        ></a-asset-item>
        <a-asset-item id="fourModel" src="../3d-models/four.glb"></a-asset-item>
        <a-asset-item id="fiveModel" src="../3d-models/five.glb"></a-asset-item>
        <a-asset-item id="sixModel" src="../3d-models/six.glb"></a-asset-item>
        <a-asset-item
          id="sevenModel"
          src="../3d-models/seven.glb"
        ></a-asset-item>
        <a-asset-item
          id="eightModel"
          src="../3d-models/eight.glb"
        ></a-asset-item>
        <a-asset-item id="nineModel" src="../3d-models/nine.glb"></a-asset-item>
        <a-asset-item id="plusModel" src="../3d-models/plus.glb"></a-asset-item>
        <a-asset-item
          id="minusModel"
          src="../3d-models/minus.glb"
        ></a-asset-item>
        <a-asset-item
          id="multiplyModel"
          src="../3d-models/multiply.glb"
        ></a-asset-item>
        <a-asset-item
          id="divideModel"
          src="../3d-models/divide.glb"
        ></a-asset-item>
        <a-asset-item
          id="equalModel"
          src="../3d-models/equal.glb"
        ></a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- Number targets (0-9) -->
      <a-entity
        id="anchor0"
        mindar-image-target="targetIndex: 0"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#zeroModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor1"
        mindar-image-target="targetIndex: 1"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#oneModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor2"
        mindar-image-target="targetIndex: 2"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#twoModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor3"
        mindar-image-target="targetIndex: 3"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#threeModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor4"
        mindar-image-target="targetIndex: 4"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.045 0.045 0.045"
          src="#fourModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor5"
        mindar-image-target="targetIndex: 5"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#fiveModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor6"
        mindar-image-target="targetIndex: 6"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#sixModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor7"
        mindar-image-target="targetIndex: 7"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#sevenModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor8"
        mindar-image-target="targetIndex: 8"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#eightModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor9"
        mindar-image-target="targetIndex: 9"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#nineModel"
        ></a-gltf-model>
      </a-entity>

      <!-- Operator targets -->
      <a-entity
        id="anchor10"
        mindar-image-target="targetIndex: 10"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#plusModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor11"
        mindar-image-target="targetIndex: 11"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#minusModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor12"
        mindar-image-target="targetIndex: 12"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.04 0.04 0.04"
          src="#multiplyModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor13"
        mindar-image-target="targetIndex: 13"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#divideModel"
        ></a-gltf-model>
      </a-entity>

      <!-- Virtual result display entities -->
      <a-entity id="virtual-equal" visible="false" position="0 0 0">
        <a-gltf-model
          rotation="90 0 0"
          scale="0.04 0.04 0.04"
          src="#equalModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity id="virtual-result" visible="false" position="0 0 0">
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#zeroModel"
        ></a-gltf-model>
      </a-entity>
    </a-scene>

    <script>
      enableAudioOnce();

      function enableAudioOnce() {
        const bg = document.getElementById("sound-bg");
        bg.volume = 0.2; // chỉnh âm lượng tùy thích
        bg.play().catch(() => {});
      }

      // Global functions for buttons
      window.goHome = function () {
        window.location.href = "../index.html";
      };

      window.showHelp = function () {
        document.getElementById("helpOverlay").classList.add("active");
      };

      window.hideHelp = function () {
        document.getElementById("helpOverlay").classList.remove("active");
      };

      // Wait for scene to load
      const sceneEl = document.querySelector("a-scene");
      sceneEl.addEventListener("renderstart", function () {
        setTimeout(() => {
          const loading = document.getElementById("loadingScreen");

          // sau 1.2s thì ẩn nội dung ở giữa để chỉ còn border
          setTimeout(() => {
            loading.classList.add("revealed");
            loading.querySelector(".loader").style.display = "none";
            loading.querySelector(".loading-text").style.display = "none";
          });
        }, 1000);
      });
    </script>

    <script type="module" src="../js/main.js"></script>
    <script type="module" src="../js/index.js"></script>
  </body>
</html>
