<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AR Math Quiz</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <link rel="stylesheet" href="../css/quiz.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
  </head>
  <body>
    <audio
      id="sound-correct"
      src="../../public/audios/correct.mp3"
      preload="auto"
    ></audio>
    <audio
      id="sound-wrong"
      src="../../public/audios/incorrect.mp3"
      preload="auto"
    ></audio>
    <audio
      id="sound-timeout"
      src="../../public/audios/timeout.mp3"
      preload="auto"
    ></audio>
    <audio
      id="sound-finish"
      src="../../public/audios/quiz-complete.mp3"
      preload="auto"
    ></audio>
    <audio
      id="sound-bg"
      src="../../public/audios/quiz-soundtrack.mp3"
      preload="auto"
      loop
    ></audio>

    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
      <div class="loader"></div>
      <div class="loading-text">Đang tải, xin chờ...</div>
    </div>

    <!-- Overlay Buttons -->
    <div class="overlay-buttons">
      <button onclick="window.location.href='../index.html'">
        <i class="fa fa-times-circle" aria-hidden="true"></i>
      </button>
    </div>

    <!-- Quiz UI -->
    <div id="quizUI" class="quiz-container">
      <div class="quiz-header">
        <div class="score-board">
          <span class="score-label">Điểm số:</span>
          <span id="scoreValue">0</span>
        </div>
        <div class="question-counter">
          <span id="currentQuestion">1</span> /
          <span id="totalQuestions">10</span>
        </div>
      </div>

      <div class="question-card" id="questionCard">
        <div class="question-text" id="questionText">
          Câu hỏi: 5 + 3 bằng bao nhiêu?
        </div>
        <div class="answer-prompt">Giơ thẻ số lên để trả lời!</div>
        <div class="timer-bar">
          <div class="timer-fill" id="timerFill"></div>
        </div>
      </div>

      <div class="feedback" id="feedback"></div>
    </div>

    <!-- Result Screen -->
    <div id="resultScreen" class="result-screen hidden">
      <div class="result-card">
        <h2 class="result-title">Hoàn thành!</h2>
        <div class="final-score">
          <div class="score-circle">
            <span id="finalScore">0</span>
          </div>
        </div>
        <div class="result-message" id="resultMessage"></div>
        <div class="result-buttons">
          <button class="btn-restart" onclick="window.restartQuiz()">
            <i class="fa fa-refresh" aria-hidden="true"></i> Chơi lại
          </button>
          <button
            class="btn-home"
            onclick="window.location.href='../index.html'"
          >
            <i class="fa fa-home" aria-hidden="true"></i> Trang chủ
          </button>
        </div>
      </div>
    </div>

    <!-- AR Scene -->
    <a-scene
      mindar-image="imageTargetSrc: ../targets.mind; maxTrack: 1; uiLoading:no; uiScanning:no; filterMinCF:0.0005; filterBeta:0.01"
      renderer="antialias: false"
      xr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
      disable-ar
    >
      <a-assets>
        <a-asset-item id="zeroModel" src="../3d-models/zero.glb"></a-asset-item>
        <a-asset-item id="oneModel" src="../3d-models/one.glb"></a-asset-item>
        <a-asset-item id="twoModel" src="../3d-models/two.glb"></a-asset-item>
        <a-asset-item
          id="threeModel"
          src="../3d-models/three.glb"
        ></a-asset-item>
        <a-asset-item id="fourModel" src="../3d-models/four.glb"></a-asset-item>
        <a-asset-item id="fiveModel" src="../3d-models/five.glb"></a-asset-item>
        <a-asset-item id="sixModel" src="../3d-models/six.glb"></a-asset-item>
        <a-asset-item
          id="sevenModel"
          src="../3d-models/seven.glb"
        ></a-asset-item>
        <a-asset-item
          id="eightModel"
          src="../3d-models/eight.glb"
        ></a-asset-item>
        <a-asset-item id="nineModel" src="../3d-models/nine.glb"></a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- Number targets (0-9) -->
      <a-entity
        id="anchor0"
        mindar-image-target="targetIndex: 0"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#zeroModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor1"
        mindar-image-target="targetIndex: 1"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#oneModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor2"
        mindar-image-target="targetIndex: 2"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#twoModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor3"
        mindar-image-target="targetIndex: 3"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#threeModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor4"
        mindar-image-target="targetIndex: 4"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.045 0.045 0.045"
          src="#fourModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor5"
        mindar-image-target="targetIndex: 5"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#fiveModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor6"
        mindar-image-target="targetIndex: 6"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#sixModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor7"
        mindar-image-target="targetIndex: 7"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#sevenModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor8"
        mindar-image-target="targetIndex: 8"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#eightModel"
        ></a-gltf-model>
      </a-entity>

      <a-entity
        id="anchor9"
        mindar-image-target="targetIndex: 9"
        visible="false"
      >
        <a-gltf-model
          rotation="90 0 0"
          scale="0.05 0.05 0.05"
          src="#nineModel"
        ></a-gltf-model>
      </a-entity>
    </a-scene>

    <script>
      enableAudioOnce();

      function enableAudioOnce() {
        const bg = document.getElementById("sound-bg");
        bg.volume = 0.2; // chỉnh âm lượng tùy thích
        bg.play().catch(() => {});
      }

      // Wait for scene to load
      const sceneEl = document.querySelector("a-scene");
      sceneEl.addEventListener("renderstart", function () {
        setTimeout(() => {
          const loading = document.getElementById("loadingScreen");
          setTimeout(() => {
            loading.classList.add("revealed");
            loading.querySelector(".loader").style.display = "none";
            loading.querySelector(".loading-text").style.display = "none";
          });
        }, 1000);
      });
    </script>

    <script type="module" src="../js/quiz/main.js"></script>
  </body>
</html>
